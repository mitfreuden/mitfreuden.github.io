---
import { getRelativeLocaleUrl } from "astro:i18n";

import Navigation from "./Navigation.astro";

const homeUrl = getRelativeLocaleUrl(Astro.currentLocale, "/");
---

<header
  class="sticky top-0 bg-neutral-50 drop-shadow-xl drop-shadow-neutral-200/50 transition-colors duration-400"
>
  <div class="container mx-auto max-w-6xl px-4 pt-1 pb-1 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between">
      <a href={homeUrl} class="site-logo opacity-0">
        <div class="flex items-center gap-1">
          <svg
            class="h-8 lg:h-10"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 40 40"
            stroke="url(#grad1)"
          >
            <!-- Square Brackets [ ] - happy eyes ^^ -->
            <defs>
              <linearGradient id="grad1" x1="0%" y1="50%" x2="20%" y2="0%">
                <stop
                  offset="0%"
                  style="stop-color:var(--color-rose-400);stop-opacity:1"
                ></stop>
                <stop
                  offset="100%"
                  style="stop-color:var(--color-orange-400);stop-opacity:1"
                ></stop>
              </linearGradient>
            </defs>
            <g>
              <path
                d="M 10 4 L 4 4 L 4 36 L 10 36"
                fill="none"
                stroke-width="1.5"
                stroke-linecap="round"></path>
              <path
                d="M 30 4 L 36 4 L 36 36 L 30 36"
                fill="none"
                stroke-width="1.5"
                stroke-linecap="round"></path>
              <path
                d="M 10 24 Q 20 32 30 24"
                fill="none"
                stroke-width="1.5"
                stroke-linecap="round"></path>
              <path
                d="M 12 18 Q 14 15 16 18"
                stroke-width="1.5"
                stroke-linecap="round"
                fill="none"></path>
              <path
                d="M 24 18 Q 26 15 28 18"
                stroke-width="1.5"
                stroke-linecap="round"
                fill="none"></path>
            </g>
          </svg>
          <div
            class="inline-block bg-linear-to-tr from-rose-600 via-rose-400 to-orange-300 bg-clip-text text-xl font-light tracking-tight text-transparent lg:text-2xl"
          >
            Mit Freuden
          </div>
        </div>
      </a>

      <div class="flex items-center gap-8">
        <Navigation />
      </div>
    </div>
  </div>
</header>

<script>
  const header = document.querySelector("header");
  const logoOnHeader = document.querySelector("header .site-logo");
  const logoOnContent = document.querySelector("main .site-logo");

  // Fade in logo on scroll
  let ticking = false;

  function handleScroll() {
    if (!ticking) {
      window.requestAnimationFrame(() => {
        const scrollPosition = window.scrollY;
        const threshold = 120;
        if (logoOnHeader) {
          if (scrollPosition > threshold) {
            logoOnHeader.classList.remove("opacity-0", "delay-0");
            logoOnHeader.classList.add(
              "opacity-100",
              "delay-300",
              "duration-500",
            );
          } else {
            logoOnHeader.classList.remove("opacity-100", "delay-300");
            logoOnHeader.classList.add("opacity-0", "delay-0");
          }
        }
        if (header) {
          if (scrollPosition > threshold) {
            header.classList.add("bg-neutral-50");
          } else {
            header.classList.remove("bg-neutral-50");
          }
        }
        ticking = false;
      });
      ticking = true;
    }
  }

  if (header && logoOnContent && logoOnHeader) {
    header.classList.remove("bg-neutral-50");
    window.addEventListener("scroll", handleScroll);
  } else if (logoOnHeader) {
    logoOnHeader.classList.remove("opacity-0");
  }
</script>
